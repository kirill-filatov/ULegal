<!doctype html>
<html lang="en-GB">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
<title>ULegal</title>
<style>
:root{
  --navy:#054A91;
  --primary:#005DAA;
  --accent:#FFC425;
  --bg:#F0F2F5;
  --card-bg: rgba(255,255,255,0.92);
  --card-border: rgba(4,64,120,0.08);
  --input-bg: rgba(247,249,251,0.95);
  --panel: rgba(230,240,250,0.95);
  --panel-border: rgba(196,217,245,1);
  --danger-bg: rgba(255,230,230,1);
  --danger-border: rgba(220,60,60,1);
  --danger-text: #A40000;
  --muted:#6F7780;
  --legal:#b0b9bf;
}
html,body{height:100%;margin:0;font-family:Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial; background:var(--bg);}
.centered{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);width:95%;max-width:480px;box-sizing:border-box;}
.card{background:var(--card-bg);border:1px solid var(--card-border);border-radius:18px;padding:24px;box-shadow:0 18px 40px rgba(4,64,120,0.12);backdrop-filter: blur(6px);max-height:85vh;overflow-y:auto;}
.header{text-align:center;display:flex;flex-direction:column;align-items:center;gap:6px;margin-bottom:16px;}
.title{font-size:1.7rem;font-weight:700;color:var(--primary);}
.subtitle{font-size:0.95rem;background:rgba(255,196,37,0.12);color:var(--accent);padding:6px 10px;border-radius:14px;font-weight:700;text-align:center;}
.sub-subtitle{font-size:0.9rem;background:transparent;color:var(--muted);font-weight:600;text-align:center;}
.form-row{display:flex;justify-content:space-between;align-items:center;margin:12px 0;flex-wrap:nowrap;}
.label{flex:0 0 auto;text-align:left;font-weight:700;color:var(--navy);white-space:nowrap;}
.label .light-label{font-weight:400;font-size:0.85rem;color:#888;margin-left:6px;display:inline-block;}
.controls{flex:0 0 auto;display:flex;justify-content:flex-end;align-items:center;}
.inline-input{display:flex;gap:6px;align-items:center;}
.input{
  width:50px; 
  padding:8px;
  border-radius:8px;
  border:1px solid var(--panel-border);
  background:var(--input-bg);
  text-align:center;
  font-size: clamp(12px, 3vw, 16px); /* dynamically scales */
  box-sizing:border-box;
}
.input::-webkit-outer-spin-button, .input::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
.output{min-width:124px;padding:10px;border-radius:10px;background:var(--panel);border:1px solid var(--panel-border);text-align:center;font-weight:800;color:var(--navy);}
.output.error { background: var(--danger-bg); border:1px solid var(--danger-border); color:var(--danger-text); }
.meta-link{display:block;margin-top:8px;color:var(--primary);text-decoration:underline;cursor:pointer;font-size:0.95rem;text-align:center;}
.version{font-size:12px;color:var(--muted);margin-top:10px;text-align:center;}
.footer-credit{font-size:13px;color:var(--muted);margin-top:6px;text-align:center;font-weight:600;}
.modal-backdrop{position:fixed;inset:0;background:rgba(0,0,0,0.45);display:none;align-items:center;justify-content:center;z-index:2000;}
.modal{width:92%;max-width:760px;background:#fff;border-radius:12px;padding:18px;box-sizing:border-box;max-height:80vh;overflow:auto;}
.modal h3{margin-top:0;}
.bottom-disclaimer{position:fixed;bottom:0;width:100%;padding:12px 8px;text-align:center;font-size:12px;color:var(--legal);background:var(--bg);box-sizing:border-box;z-index:1000;border-top:1px solid #ccc;}
@media(max-width:460px){
  .input{ width:45px; }
  .output{ min-width:110px; }
}
</style>
</head>
<body>

<div class="centered">
  <div id="calcCard" class="card">
    <div class="header">
      <div class="title">ULegal</div>
      <div class="subtitle">Maximum Legal Duty Time Calculator</div>
      <div class="sub-subtitle">Domestic Only</div>
    </div>

    <!-- Report Time -->
    <div class="form-row">
      <div class="label">Report Time <span class="light-label">actual</span></div>
      <div class="controls">
        <div class="inline-input">
          <input id="reportHour" class="input" type="text" inputmode="numeric" placeholder="Hours">
          <input id="reportMin" class="input" type="text" inputmode="numeric" placeholder="Minutes">
        </div>
      </div>
    </div>

    <!-- Duty Hours -->
    <div class="form-row">
      <div class="label">Duty Hours <span class="light-label">scheduled</span></div>
      <div class="controls">
        <div class="inline-input">
          <input id="dutyHours" class="input" type="text" inputmode="numeric" placeholder="Hours">
          <input id="dutyMins" class="input" type="text" inputmode="numeric" placeholder="Minutes">
        </div>
      </div>
    </div>

    <!-- Departure -->
    <div class="form-row">
      <div class="label">Departure <span class="light-label">scheduled</span></div>
      <div class="controls">
        <div class="inline-input">
          <input id="depHour" class="input" type="text" inputmode="numeric" placeholder="Hours">
          <input id="depMin" class="input" type="text" inputmode="numeric" placeholder="Minutes">
        </div>
      </div>
    </div>

    <!-- Door Closed -->
    <div class="form-row">
      <div class="label">Door Closed</div>
      <div class="controls">
        <div id="doorClosed" class="output">—</div>
      </div>
    </div>

    <a id="explainLink" class="meta-link">How we calculated this?</a>
    <div class="version">Public Beta 1.70</div>
    <div class="footer-credit">© 2025 @kirillfilatov</div>
  </div>
</div>

<div class="bottom-disclaimer">
  This tool is not an official United Airlines product. It is provided solely for informational purposes and should not be used as a substitute for the JCBA. Users should independently verify all results before operational action.
</div>

<div id="modalBackdrop" class="modal-backdrop">
  <div class="modal">
    <h3>Calculation: Step-by-step (Report Time = actual)</h3>
    <div id="modalContent"></div>
    <div style="text-align:right;margin-top:12px;"><button id="closeModal">Close</button></div>
  </div>
</div>

<script>
// Utility functions
function pad2(n){return String(n).padStart(2,'0');}
function onlyDigits(s){return (s||'').replace(/\D/g,'');}
function toIntSafe(s,max){const v=onlyDigits(s);if(v==='') return NaN;let n=parseInt(v,10);if(isNaN(n)) return NaN;if(n<0)n=0;if(typeof max==='number'&&n>max)n=max;return n;}
function minutesFromInputs(hourEl,minEl){const h=toIntSafe(hourEl.value,23);const m=toIntSafe(minEl.value,59);if(isNaN(h)&&isNaN(m))return NaN;return (isNaN(h)?0:h)*60 + (isNaN(m)?0:m);}
function minutesToHHMM(mins){mins=Math.round(mins);mins=((mins%1440)+1440)%1440;const h=Math.floor(mins/60),m=mins%60;return pad2(h)+':'+pad2(m);}
function computeMaxActual(reportMinutes){return (reportMinutes>=300&&reportMinutes<=1139)?15*60:11*60+30;}

// Elements
const reportHourEl=document.getElementById('reportHour');
const reportMinEl=document.getElementById('reportMin');
const dutyHoursEl=document.getElementById('dutyHours');
const dutyMinsEl=document.getElementById('dutyMins');
const depHourEl=document.getElementById('depHour');
const depMinEl=document.getElementById('depMin');
const doorEl=document.getElementById('doorClosed');
const explainLink=document.getElementById('explainLink');
const modalBackdrop=document.getElementById('modalBackdrop');
const modalContent=document.getElementById('modalContent');
const closeModalBtn=document.getElementById('closeModal');

// Wire input fields
function wireInput(el,max){
  el.addEventListener('input',()=>{
    el.value=onlyDigits(el.value);
    if(el.value===''){doorEl.textContent='—';doorEl.classList.remove('error');return;}
    let n=parseInt(el.value,10);if(isNaN(n))return;if(n<0)n=0;if(n>max)n=max;el.value=pad2(n);
    update();
  });
  el.addEventListener('blur',()=>{if(el.value==='')return;el.value=pad2(parseInt(onlyDigits(el.value)||'0',10));});
  el.addEventListener('paste',(ev)=>{const text=(ev.clipboardData||window.clipboardData).getData('text');if(/\D/.test(text))ev.preventDefault();});
  el.addEventListener('keydown',(ev)=>{if(ev.key.length===1&&/\D/.test(ev.key))ev.preventDefault();});
}
[reportHourEl,reportMinEl,dutyHoursEl,dutyMinsEl,depHourEl,depMinEl].forEach(el=>{wireInput(el,el.id.includes('Hour')?23:59);});

// Update calculation
function update(){
  doorEl.classList.remove('error');doorEl.style.textAlign='center';
  const r=minutesFromInputs(reportHourEl,reportMinEl);
  const duty=minutesFromInputs(dutyHoursEl,dutyMinsEl);
  const dep=minutesFromInputs(depHourEl,depMinEl);
  if(isNaN(r)||isNaN(duty)||isNaN(dep)){doorEl.textContent='—';return;}
  const reportIsDay=(r>=300&&r<=1139);
  const allowedScheduledMax=reportIsDay?13*60:11*60+30;
  if(duty>allowedScheduledMax){doorEl.classList.add('error');doorEl.textContent='Error. Scheduled duty violates the contract.';return;}
  const maxActual=computeMaxActual(r);
  const timeDiff=maxActual-duty;
  if(timeDiff<0||!isFinite(timeDiff)){doorEl.classList.add('error');doorEl.textContent='Error. Verify your times';return;}
  const doorClosedMinutes=dep+timeDiff;
  doorEl.textContent=minutesToHHMM(doorClosedMinutes);
  doorEl.style.textAlign='center';
}

// Modal explanation
explainLink.addEventListener('click',()=>{
  const r=minutesFromInputs(reportHourEl,reportMinEl);
  const duty=minutesFromInputs(dutyHoursEl,dutyMinsEl);
  const dep=minutesFromInputs(depHourEl,depMinEl);
  modalContent.innerHTML=`<p>Report Time: ${minutesToHHMM(r)}</p>
  <p>Scheduled Duty: ${minutesToHHMM(duty)}</p>
  <p>Scheduled Departure: ${minutesToHHMM(dep)}</p>
  <p>Max Actual Duty: ${computeMaxActual(r)/60}h</p>
  <p>Time Difference = Max Actual - Scheduled Duty</p>
  <p>Door Closed = Scheduled Departure + Time Difference</p>`;
  modalBackdrop.style.display='flex';
});
closeModalBtn.addEventListener('click',()=>{modalBackdrop.style.display='none';});
</script>
</body>
</html>
